const VIEWABLE_EXTENSIONS=["XLS","XLSX","XLSM","XLSB","ODS"],SCOPES="https://www.googleapis.com/auth/drive.file",CLIENT_ID=o.GoogleDriveConfigurations.GoogleDriveClientId,API_KEY=o.GoogleDriveConfigurations.GoogleDriveApiKey,APP_ID=o.GoogleDriveConfigurations.GoogleDriveProjectId,REGULAR_MAIL=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,REGULAR_URL=/https?:\/\/(www\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_+.~#?&/=]*)/gi,REGULAR_NULL=/^\s+$/;let TokenClient,AccessToken=null,PickerInited=!1,GisInited=!1,fileDrop={},fileDrop2={},UploadFileName="",WatermarkType="None",WatermarkImageStream=null;const Urls={Login:`${o.OidcDomain}/cells/auth/login?redirect_uri=${window.location.href}`,Logout:`${o.OidcDomain}/cells/auth/logout?redirect_uri=${window.location.href}`},INDEXED_DB_ID=`${o.AppName}_${o.ActionName}`.toLocaleUpperCase(),CONSTANT_PREFIX="_cells_",DAILY_USAGE_LIMIT=o.DailyUsageLimit,USAGE_COUNT_KEY=`${CONSTANT_PREFIX}user_usage_count`,USAGE_DATE_KEY=`${CONSTANT_PREFIX}user_usage_data`,USER_FINGERPRINT_KEY=`${CONSTANT_PREFIX}user_fingerprint`,ALERT_DURATION=5e3,DEFAULT_MAXIMUM_UPLOAD_FILES=50,IFRAME_PATH=`${CONSTANT_PREFIX}iframe_path`;function checkLoginStatus(){var e=`${o.APIBasePath}Common/GetUserType`;fetch(e,{method:"GET",headers:{"Cache-Control":"no-store, max-age=0"},credentials:"include"}).then(e=>{if(!e.ok)throw new Error("Network response was not ok");return e.json()}).then(e=>{"Anonymous"===e.userType?($(".loggedin").addClass("hidden"),$(".logout-url").prop("href",""),$("#userNameLink").text(""),$(".login").removeClass("hidden"),$(".login-url").prop("href",Urls.Login),$(".restricted").click(function(e){e.preventDefault(),showLoginOrUpgradePopup()}).find("input, select").css({"background-color":"#eee","pointer-events":"none"})):($(".login").addClass("hidden"),$(".login-url").prop("href",""),$(".loggedin").removeClass("hidden"),$(".logout-url").prop("href",Urls.Logout),$("#userNameLink").text(e.userName))}).catch(e=>{})}function showModal(e){const o=$(`#${e}`);o.on("show.bs.modal",function(){o.css("display","flex")}),o.modal("show")}function showUsageLimitModal(e){hideLoader();const o=$("#UsageLimitModal");o.on("show.bs.modal",function(){o.css("display","flex"),IsNullOrEmpty(e)||$("#UsageLimitModalBody").empty().append(e)}),o.modal("show")}function getTodayDate(){const e=new Date;return e.toISOString().split("T")[0]}async function getUserFingerprint(){const e=await FingerprintJS.load();return(await e.get()).visitorId}async function checkUsageLimit(){var e=await getUserFingerprint(),t=`${USER_FINGERPRINT_KEY}_${e}`;let n=JSON.parse(localStorage.getItem(t))||{};e=getTodayDate();return n[USAGE_DATE_KEY]!==e?(n[USAGE_DATE_KEY]=e,n[USAGE_COUNT_KEY]=0,localStorage.setItem(t,JSON.stringify(n)),!0):(n[USAGE_COUNT_KEY]&&!o.Authed||(n[USAGE_COUNT_KEY]=0),!(n[USAGE_COUNT_KEY]>=DAILY_USAGE_LIMIT)&&(n[USAGE_COUNT_KEY]+=1,localStorage.setItem(t,JSON.stringify(n)),!0))}function showLoader(e){$("#progressbar").modal({backdrop:"static",keyboard:!1,show:!0}),hideAlert(),$("#uploadButton").attr("disabled",!0),e&&e.attr("disabled",!0)}function hideLoader(e){$("#progressbar").modal("hide"),$("#uploadButton").attr("disabled",!1),e&&e.attr("disabled",!1)}function sendPageView(e){if("ga"in window)try{const o=ga.getAll()[0];void 0!==o&&o.send("pageview",e)}catch(e){}}function getViewPath(){return"en"===o.Locale?"/cells/viewer/view":`/cells/${o.Locale}/viewer/view`}function generateViewerLink(e,o){var t=void 0!==e.FolderName?e.FolderName:e.id,o=IsNullOrEmpty(o)?"":encodeURIComponent(o);return encodeURI(`${getViewPath()}?FolderName=${t}&Password=${o}&FileName=${encodeURIComponent(e.FileName)}&Uid=${encodeURIComponent(e.Uid)}`)}function generateViewerAddressBarUrl(e){var o=void 0!==e.FolderName?e.FolderName:e.id;return encodeURI(`${getViewPath()}?FolderName=${o}&FileName=${encodeURIComponent(e.FileName)}&Uid=${encodeURIComponent(e.Uid)}`)}function generatePageViewUrl(e,o){return encodeURI(`${e}FileName=${encodeURIComponent(o.FileName)}`)}function copyPlainText(){navigator.permissions.query({name:"clipboard-write"}).then(function(e){"granted"===e.state?copyResultText():"prompt"===e.state&&(e.onchange=function(e){"granted"===e.state&&copyResultText()})})}function copyResultText(){const e=$("#copyBtn");e.attr("disabled",!0);const o=e.html();var t=$("#textarea").val();navigator.clipboard.writeText(t).then(function(){e.html("copy successfully"),e.css("background","#198754"),setTimeout(function(){e.html(o),e.attr("disabled",!1),e.css("background","#666")},2e3)},function(){e.html("copy failed"),e.css("background","#dc3545"),setTimeout(function(){e.html(o),e.attr("disabled",!1),e.css("background","#666")},2e3)})}function fallbackCopyTextToClipboard(e){const o=document.createElement("textarea");o.value=e,o.style.top="0",o.style.left="0",o.style.position="fixed",document.body.appendChild(o),o.focus(),o.select();try{document.execCommand("copy")}catch(e){}document.body.removeChild(o)}function IsNullOrEmpty(e){return null==e||""===e||"null"===e||"undefined"===e}function previewTextImage(r){return new Promise((e,t)=>{if(IsNullOrEmpty(r.OutTxt)||"true"!==r.OutTxt.toLocaleString()||fetchAndDisplayLargeText(`${o.APIBasePath}Common/GetLargeTextAsStream?folderName=${r.FolderName}&filename=${r.FileName}`,"textarea","TextPreview").then(()=>{e()}).catch(e=>{t(new Error("Read error: "+e))}),!IsNullOrEmpty(r.ThumbnailUrl)){var n=$(`<img loading="lazy" src="${r.ThumbnailUrl}" class="preview-image" alt="">`);const a=$("#ThumbnailPreview");a.append(n),a.removeClass("hidden"),e()}e()})}function workSuccess(a){200===a.StatusCode?void 0===a.FileProcessingErrorCode||0===a.FileProcessingErrorCode?previewTextImage(a).then(function(){if(hideLoader(),$("#WorkPlaceHolder").addClass("hidden"),$("#AppDescription").addClass("hidden"),$("#HowTo").addClass("hidden"),$("#AppFeatures").addClass("hidden"),$("#statProcessed").children().addClass("hidden"),$("#TextPlaceHolder").addClass("hidden"),$("#DownloadPlaceHolder").removeClass("hidden"),$("#OtherApps").removeClass("hidden"),void 0===o.ReturnFromViewer&&sendPageView(-1===(e=o.AppDownloadURL.indexOf("?"))?o.AppDownloadURL:o.AppDownloadURL.substring(0,e)),o.DownloadUrl=`${encodeURI(`${o.APIBasePath}Download/${a.FolderName}`)}?file=${encodeURIComponent(a.FileName)}`,$("#DownloadButton").attr("href",o.DownloadUrl),o.ShowViewerButton){const t=$("#ViewerLink");var e=a.FileName.lastIndexOf("."),e=0<=e?a.FileName.substring(e+1).toLocaleUpperCase("en-US"):null;null!==e&&t.length&&-1!==VIEWABLE_EXTENSIONS.indexOf(e)?t.on("click",function(e){e.preventDefault(),e.stopPropagation();const o=$("#password");e=void 0!==o?o.val():"";openIframe(generateViewerLink(a,e),generateViewerAddressBarUrl(a),generatePageViewUrl(`${getViewPath()}?`,a))}):t.hide()}if(o.ShowDeleteButton){const n=$("#DeleteButton");n.click(function(){showDelModal(a.FolderName,a.FileName)})}$("#DropboxSaveButton").click(function(){Dropbox.save(o.DownloadUrl,a.FileName,{success:function(){showCloudUploadTips("Successfully saved to Dropbox")},progress:function(){showCloudWaiter()},cancel:function(){$("#CloudWait").hide()},error:function(){showCloudUploadTips("Failed to save to Dropbox","indianred")}})}),$("#GoogleDriveSaveButton").click(function(){TokenClient.callback=async e=>{if(void 0!==e.error)throw e;AccessToken=e.access_token,showCloudWaiter(),fetch(o.DownloadUrl).then(e=>e.blob()).then(e=>{const o=new FormData;o.append("metadata",new Blob([JSON.stringify({name:a.FileName})],{type:"application/json"})),o.append("file",e),fetch("https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart",{method:"POST",headers:new Headers({Authorization:`Bearer ${AccessToken}`}),body:o}).then(e=>e.json(),function(e){showCloudUploadTips("Failed to save to Google Drive","indianred")}).then(()=>{showCloudUploadTips("Successfully saved to Google Drive")})})},null===AccessToken?TokenClient.requestAccessToken({prompt:"consent"}):TokenClient.requestAccessToken({prompt:""})}),restoreOtherApps(),window.scrollTo({top:0,behavior:"smooth"}),"Comparison"!==o.AppName&&"ImportData"!==o.ActionName&&"ImportCsv"!==o.ActionName&&openDB().then(function(e){deleteDataBase(e).then()})}):showAlert(o.FileProcessingErrorCodes[a.FileProcessingErrorCode]):ProcessErrorStatusCode(a)}function ProcessErrorStatusCode(e){switch(e.StatusCode){case 4001:"Unlock"!==o.AppName&&$("#filePwdGroup").removeClass("hidden"),showAlert(e.Status);break;case 401:hideLoader(),showLoginModal(e.Status);break;case 403:hideLoader(),showUpgradeBillingModal(e.Status);break;case 500:hideLoader(),showReportModal(e);break;default:showAlert(e.Status)}}function showCloudWaiter(){$("#CloudWait").show(),$("#CloudUploadTip").hide()}function showCloudUploadTips(e,o="#439cda"){$("#CloudWait").hide(),$("#CloudUploadTip").css("background",o).html(e).show()}function sendEmail(){var e=$("#EmailToInput").val();e&&REGULAR_MAIL.test(String(e).toLocaleLowerCase("en-US"))?(e={appname:o.AppName,email:e,url:o.DownloadUrl,title:o.Title},$("#sendEmailModal").modal("hide"),$("#sendEmailButton").addClass("hidden"),$.ajax({method:"POST",url:`/cells/${o.AppName.toLocaleLowerCase("en-US")}/SendEmail`,xhrFields:{withCredentials:!0},crossDomain:!0,data:e,dataType:"json",success:e=>{showMessage(e.message)},complete:()=>{$("#sendEmailButton").removeClass("hidden"),hideLoader()},error:e=>{showAlert(e.responseJSON.message)}})):alert("Please specify the valid email address!")}function sendFeedback(e,t){var n="string"==typeof t?t:$("#feedbackText").val();if(!(!n||REGULAR_NULL.test(n)||1e3<n.length)){if(!t&&"ga"in window)try{const a=window.ga.getAll()[0];void 0!==a&&a.send("event",{eventCategory:"Social",eventAction:"feedback-in-download"})}catch(e){}$.ajax({method:"POST",url:`${o.APIBasePath}Report/Feedback`,xhrFields:{withCredentials:!0},crossDomain:!0,data:{appName:o.AppName.toLocaleUpperCase("en-US"),text:n,email:e},dataType:"json",success:e=>{$("#feedbackEmail").val(""),$("#feedbackBody").val(""),showMessage(e.message),$("#feedback").hide()},error:e=>{showAlert(e.responseJSON.message)}})}}function hideAlert(){const e=$("#alertMessage");e.addClass("hidden"),e.text(""),e.addClass("hidden"),e.text(""),$("#alertPlaceHolder").addClass("hidden")}function showAlert(e){hideLoader();const o=$("#alertMessage");o.html(e),o.removeClass("hidden"),$("#alertPlaceHolder").removeClass("hidden"),scrollToBottom(document.getElementById("alertPlaceHolder"))}function scrollToBottom(e){e=e.getBoundingClientRect();window.scrollTo({top:window.scrollY+e.bottom-window.innerHeight,behavior:"smooth"})}function showMessage(e){hideLoader();const o=$("#alertSuccess");o.text(e),o.removeClass("hidden"),$("#alertPlaceHolder").removeClass("hidden")}function progress(o){if(o.lengthComputable){var t=o.total,o=o.loaded;let e=Math.round(100*o/t);e=`${e<15?15:e}%`;const n=$(".progress > .progress-bar");n.html(e),n.css("width",e)}}function removeAllFileBlocks(){fileDrop.reset(),"Comparison"===o.AppName&&fileDrop2.reset(),hideLoader()}function openIframe(e,t,n){localStorage.setItem(IFRAME_PATH,window.location.pathname),window.history.pushState(null,null,t),$("body").css("overflow-y","hidden");const a=$('<div id="iframe-wrap"></div>');$("<iframe>",{src:e,id:"iframe-document",frameborder:0,scrolling:"yes"}).appendTo(a),a.appendTo("body"),sendPageView(n),"Comparison"!==o.AppName&&"ImportData"!==o.ActionName&&"ImportCsv"!==o.ActionName&&openDB().then(function(e){deleteDataBase(e).then()})}function closeIframe(){var e=localStorage.getItem(IFRAME_PATH);e&&window.history.pushState(null,null,e),removeAllFileBlocks(),$("div#iframe-wrap").remove(),$("body").css("overflow-y","auto")}function request(e,o){showLoader(),$.ajax({method:"POST",url:e,xhrFields:{withCredentials:!0},crossDomain:!0,data:o,processData:!1,contentType:!1,cache:!1,success:workSuccess,error:function(e){void 0!==e.data&&void 0!==e.data.Status?showAlert(e.data.Status):0===e.readyState&&0===e.status&&"abort"===e.statusText?showAlert("Cancelled"):showAlert(`Error ${e.status}: ${e.statusText}`)}})}function showReportModal(e){$("#errorTitle").text(e.Status),$("#errorModal").modal("show"),$("#errorFolderName").val(e.FolderName);let t=e.Text;IsNullOrEmpty(e.Text)&&(t=`${o.ActionName}-${o.Extension}-to-${o.Extension2}`),$("#errorAction").val(`${o.AppName}-${t}`);let n=e.Status;IsNullOrEmpty(e.ErrorDetails)||(n=e.ErrorDetails.Message),$("#errorMessage").val(n)}function showUpgradeBillingModal(){const e=$("#upgradeBillingModal");e.on("show.bs.modal",function(){e.css("display","flex")}),e.modal("show")}function showLoginModal(e){const o=$("#loginModal");o.on("show.bs.modal",function(){o.css("display","flex"),IsNullOrEmpty(e)||$("#loginModalBody").empty().append(e)}),o.modal("show")}function showDelModal(o,t){$("#delModal").modal({backdrop:"static",keyboard:!1,show:!0}),$("#confirmDelBtn").click(function(){const e=$("#DownloadButton");e.removeAttr("href"),e.removeAttr("onclick"),requestDeleteFile(o,t)})}function requestDeleteFile(e,t){$("#confirmDelBtn").attr("disabled","true");var n=`${o.APIBasePath}Common/Delete`;$.ajax({method:"DELETE",url:n,xhrFields:{withCredentials:!0},crossDomain:!0,data:JSON.stringify({FolderName:e,Filename:t}),contentType:"application/json",cache:!1,success:()=>{responseDeleteFile(!0)},error:()=>{responseDeleteFile(!1)}})}function responseDeleteFile(e){$("#delModal").modal("hide"),$("#confirmDelBtn").removeAttr("disabled");var o=e?"Your files have been deleted successfully!":"Deletion failed! Please try again later";$("#delResModalBody").html(o),$("#delResModal").modal({backdrop:"static",keyboard:!1,show:!0}),setTimeout(function(){$("#delResModal").modal("hide")},1500),e&&$("#delResModal").on("hide.bs.modal",function(){$("#DeleteButton").unbind("click"),window.location.reload()})}function validateUnlock(){return!!$("#passw").val().length||(showAlert(o.validationMessage),!1)}function shareApp(e){if(-1!==["facebook","twitter","linkedin","cloud","feedback","otherapp","bookmark","github"].indexOf(e)){var o=window.location.href,t=document.title.replace("&","and");switch(!function(e,o){if(o=o||"Social","ga"in window)try{const t=window.ga.getAll()[0];void 0!==t&&t.send("event",{eventCategory:o,eventAction:e})}catch(e){}}(e.charAt(0).toLocaleUpperCase("en-US")+e.slice(1)),e){case"facebook":window.open(`https://www.facebook.com/sharer/sharer.php?u=#${encodeURI(o)}`);break;case"twitter":window.open(`https://twitter.com/intent/tweet?text=${encodeURI(t)}&url=${encodeURI(o)}`);break;case"linkedin":window.open(`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURI(o)}`);break;case"feedback":$("#feedbackModal").modal({keyboard:!0});break;case"otherapp":document.location.href="https://products.aspose.app/cells/family";break;case"cloud":window.open("https://products.aspose.cloud/cells/family");break;case"github":window.open("https://github.com/aspose-cells/Aspose.Cells-for-.NET");break;case"bookmark":$("#bookmarkModal").modal({keyboard:!0})}}}function sendFeedbackExtended(){var e=$("#feedbackEmail").val(),o=$("#feedbackBody").val();o&&!REGULAR_NULL.test(o)?1e3<o.length?alert("The feedback content exceeds 1000 characters"):REGULAR_MAIL.test(e)?o&&!REGULAR_NULL.test(o)&&($("#feedbackModal").modal("hide"),sendFeedback(e,o)):alert("The email is invalid"):alert("The feedback content is empty")}function otherAppClick(e,o=!1){if("ga"in window)try{const t=window.ga.getAll()[0];void 0!==t&&t.send("event",{eventCategory:"Other App Click"+(o?" Left":""),eventAction:e})}catch(e){}}function restoreOtherApps(){$("#otherapps-panel").addClass("otherapps-panel-collapse"),$(".otherapps-panel-expand").show(),$(".otherapps-panel-restore").addClass("hidden")}function requestErrorReport(){const t=document.getElementById("reportError");t.disabled=!0;const e=$("#errorEmail");if(""===e.val().trim())return t.disabled=!1,void alert("email is invalid");if(!REGULAR_MAIL.test(e.val()))return t.disabled=!1,void alert("email is invalid");$("#forumPrivate").prop("checked")?$("#errorPrivate").val("true"):$("#errorPrivate").val("false");var n=`${o.APIBasePath}Report/Error`;$.ajax({method:"POST",url:n,xhrFields:{withCredentials:!0},crossDomain:!0,data:$("#errorForm").serialize(),contentType:"application/x-www-form-urlencoded",cache:!1,success:e=>{t.disabled=!1,200===e.StatusCode?($("#errorModal").modal("hide"),$("#lnkForums").attr("href",e.ForumLink),$("#reportResultModal").modal("show")):alert(e.Status)},error:()=>{t.disabled=!1,alert("Try again later")}})}function pushUrl(){const t=$("#loadUrlModalInput");var e=t.val();REGULAR_URL.test(e)?fetch(e).then(e=>e.blob()).then(e=>{$("#loadUrlModal").modal("hide");const o=new FileReader;showLoader(),o.readAsText(e),o.onloadend=function(){$("#inputTxt").val(o.result),hideLoader()},t.val("")}):($("#loadUrlModal").modal("hide"),showAlert("Invalid URL"),window.setTimeout(function(){hideAlert()},ALERT_DURATION))}function heightToTop(e){var o=document.body;let t=0;for(;t+=e.offsetTop,(e=e.offsetParent)!==o;);return t}function scrollToTop(e){window.scrollTo({top:heightToTop(e.target),behavior:"smooth"})}function checkNumber(e,o,t,n){let a=parseInt(e.val());a>t&&(a=t,showAlert(n),window.setTimeout(function(){hideAlert()},3e3)),a<o&&(a=o,showAlert(n),window.setTimeout(function(){hideAlert()},ALERT_DURATION)),e.val(a)}function resetWatermarkFormData(e){e.delete("WatermarkType"),e.delete("WatermarkTextContent"),e.delete("WatermarkTextSize"),e.delete("WatermarkTextColor"),e.delete("WatermarkOpacity"),e.delete("WatermarkPosition"),e.delete("WatermarkTextRepeatEnable"),e.delete("WatermarkTextSpacing"),e.delete("WatermarkRotatedDegree"),e.delete("WatermarkTextItalic"),e.delete("WatermarkTextBold"),e.delete("WatermarkImageScaleToPagePercent"),e.delete("WatermarkTextScaleToPagePercent"),e.delete("WatermarkScaleToPagePercent")}function setWatermarkFormData(e){if("Image"===WatermarkType){if(IsNullOrEmpty(WatermarkImageStream))return showAlert("Please select a watermark image"),window.setTimeout(function(){hideAlert()},ALERT_DURATION),!1;e.set("WatermarkType","Image"),e.set("WatermarkImage",WatermarkImageStream),e.set("WatermarkOpacity",$("#WatermarkOpacityImage").val()/100),e.set("WatermarkPosition",$("#WatermarkPositionImage").val()),e.set("WatermarkScaleToPagePercent",Number.parseInt($("#WatermarkImageScaleToPagePercent").val()))}if("Text"===WatermarkType){var o=$("#WatermarkTextContent").val();if(IsNullOrEmpty(o))return showAlert("Please input the watermark text"),window.setTimeout(function(){hideAlert()},ALERT_DURATION),!1;const t=$("#WatermarkTextRepeatEnable");0<t.length&&"true"===t.val()&&(e.set("WatermarkTextRepeatEnable",!0),e.set("WatermarkTextSpacing",$("#WatermarkTextSpacing").val()),e.set("WatermarkRotatedDegree",$("#WatermarkRotatedDegree").val())),e.set("WatermarkType","Text"),e.set("WatermarkTextContent",o),e.set("WatermarkTextSize",$("#WatermarkTextSize").val()),e.set("WatermarkTextColor",$("#WatermarkTextColor").val()),e.set("WatermarkOpacity",$("#WatermarkOpacityText").val()/100),e.set("WatermarkPosition",$("#WatermarkPositionText").val()),e.set("WatermarkScaleToPagePercent",Number.parseInt($("#WatermarkTextScaleToPagePercent").val()));const n=$("#WatermarkTextItalic");0<n.length&&e.set("WatermarkTextItalic",n.val());const a=$("WatermarkTextBold");0<a.length&&e.set("WatermarkTextBold",a.val())}return!0}async function fetchAndDisplayLargeText(t,n,a){try{const l=await fetch(t);if(!l.ok)return;const i=await l.blob(),s=document.getElementById(n),d=document.getElementById(a);d.classList.remove("hidden");let e=0;let o="";for(;e<i.size;){const c=i.slice(e,e+1048576);var r=await new Promise((o,t)=>{const e=new FileReader;e.onload=e=>o(e.target.result),e.onerror=e=>t(`Read error: ${e}`),e.readAsText(c)});o+=r,e+=1048576}s.value=o}catch(e){}}function openDB(){return new Promise((o,t)=>{const e=indexedDB.open("AsposeCells",1);e.onupgradeneeded=function(e){const o=e.target.result;o.createObjectStore("files",{keyPath:"id"})},e.onsuccess=function(e){e.target.result;o(e.target.result)},e.onerror=function(e){t(e.target.error)}})}async function updateDataBase(e,o){const t=e.transaction("files","readwrite"),n=t.objectStore("files");o={id:INDEXED_DB_ID,files:o};const a=n.put(o);return new Promise((e,o)=>{a.onsuccess=function(){e()},a.onerror=function(e){o(e.target.error)}})}async function getDataBase(e){const o=e.transaction("files","readonly"),t=o.objectStore("files"),n=t.get(INDEXED_DB_ID);return new Promise((e,o)=>{n.onsuccess=function(){e(n.result)},n.onerror=function(e){o(e.target.error)}})}async function deleteDataBase(e){const o=e.transaction(["files"],"readwrite"),t=o.objectStore("files"),n=t.delete(INDEXED_DB_ID);return new Promise((e,o)=>{n.onsuccess=function(){e(n.result)},n.onerror=function(e){o(e.target.error)}})}$(document).ready(function(){function I(e,o){let t=!1;return 1024*o.MaximumUploadFileSize*1024<e&&(t=!0),t}function C(e){let o=DEFAULT_MAXIMUM_UPLOAD_FILES<e?!0:!1;return o}checkLoginStatus();const c=$("#uploadButton");function y(e){switch(e){case 0:showModal("Login2UpFileCountModal");break;case 1:showModal("Premium2UpFileCountModal");break;case 3:showModal("Business2UpFileCountModal");break;default:showModal("Login2UpFileCountModal")}}function D(e){switch(e){case 0:showModal("Login2UpFileSizeModal");break;case 1:showModal("Premium2UpFileSizeModal");break;case 3:showModal("Business2UpFileSizeModal");break;default:showModal("Login2UpFileSizeModal")}}c.on("click",function(t){checkUsageLimit().then(function(e){e?o.UploadAndRedirect||o.Method(t,...arguments):showUsageLimitModal()})}),$("form#UploadFile div.action-collection").each(function(){0===$(this).children().length&&$(this).css("margin","0 auto")}),$.fn.fileDrop=function(u){const p=(u.dropFileId=u.dropFileId+1,u.dropFileId-1),h=u.Accept.split(/\s*,\s*/).map(function(e){return e.substring(1).toLocaleUpperCase("en-US")});let m=[],f={};function g(e){var o=e.name.lastIndexOf(".");return-1!==o?e.name.substring(o+1).toLocaleUpperCase("en-US"):null}function i(e,o,t=!1){if(C(m.length+1))return y(u.UserType),u.showAlert(u.FileProcessingErrorCodes[10004]),window.setTimeout(()=>{hideAlert()},ALERT_DURATION),0;if(I(e.size,u))return D(u.UserType),u.showAlert(u.FileProcessingErrorCodes[10005]),window.setTimeout(function(){u.hideAlert()},ALERT_DURATION),0;const n=w();var a=e.name;let r=null,l=null;u.UseSorting&&(r=$(`
                    <a>
                        <i>
                        <svg class="fa icon icon-arrow-up frame0" viewBox="0 0 30 32"><path d="M28.768 17.339q0 0.911-0.661 1.607l-1.339 1.339q-0.679 0.679-1.625 0.679-0.964 0-1.607-0.679l-5.25-5.232v12.571q0 0.929-0.67 1.509t-1.616 0.58h-2.286q-0.946 0-1.616-0.58t-0.67-1.509v-12.571l-5.25 5.232q-0.643 0.679-1.607 0.679t-1.607-0.679l-1.339-1.339q-0.679-0.679-0.679-1.607 0-0.946 0.679-1.625l11.625-11.625q0.625-0.661 1.607-0.661 0.964 0 1.625 0.661l11.625 11.625q0.661 0.696 0.661 1.625z"/></svg>
                        </i>
                    </a>
                `),l=$(`
                    <a>
                        <i>
                        <svg class="fa icon icon-arrow-down frame0" viewBox="0 0 30 32"><path d="M28.768 14.857q0 0.946-0.661 1.607l-11.625 11.643q-0.696 0.661-1.625 0.661-0.946 0-1.607-0.661l-11.625-11.643q-0.679-0.643-0.679-1.607 0-0.946 0.679-1.625l1.321-1.339q0.696-0.661 1.625-0.661 0.946 0 1.607 0.661l5.25 5.25v-12.571q0-0.929 0.679-1.607t1.607-0.679h2.286q0.929 0 1.607 0.679t0.679 1.607v12.571l5.25-5.25q0.661-0.661 1.607-0.661 0.929 0 1.625 0.661l1.339 1.339q0.661 0.696 0.661 1.625z"/></svg>
                        </i>
                    </a>
                `),r.find("i").on("click",function(){k(n)}),l.find("i").on("click",function(){T(n)}));const i=$(`
                <a>
                    <i>
                    <svg class="fa icon icon-close frame0" viewBox="0 0 25 32"><path d="M23.179 23.607q0 0.714-0.5 1.214l-2.429 2.429q-0.5 0.5-1.214 0.5t-1.214-0.5l-5.25-5.25-5.25 5.25q-0.5 0.5-1.214 0.5t-1.214-0.5l-2.429-2.429q-0.5-0.5-0.5-1.214t0.5-1.214l5.25-5.25-5.25-5.25q-0.5-0.5-0.5-1.214t0.5-1.214l2.429-2.429q0.5-0.5 1.214-0.5t1.214 0.5l5.25 5.25 5.25-5.25q0.5-0.5 1.214-0.5t1.214 0.5l2.429 2.429q0.5 0.5 0.5 1.214t-0.5 1.214l-5.25 5.25 5.25 5.25q0.5 0.5 0.5 1.214z"/></svg>
                    </i>
                </a>
            `);i.find("i").on("click",function(){v(n)});const s=$(`
                <span class="filename">
                    <label class="custom-file-upload">${a}</label>
                </span>
            `);null!==r&&null!==l&&(s.append(r),s.append(l)),s.append(i);const d=$(`<div id="fileupload-${p}-${n}" class="fileupload"></div>`);d.on("dragover",A),d.on("drop",A),d.append(s),d.insertBefore(`#${o}`);var c,a={id:n,file:e,name:a,idUploadBlock:o};m.push(a),"Comparison"!==u.AppName&&"ImportData"!==u.ActionName&&"ImportCsv"!==u.ActionName&&openDB().then(function(e){updateDataBase(e,m).then()}),o="fileChange",c={file:a},f[o]&&f[o].forEach(e=>e(c)),t&&b()}const w=function(){let e=p,o;do{o=!1;for(const t of m)if(t.id===e){e+=1,o=!0;break}}while(o);return e},s=function(){let e=p,o;do{o=!1;for(const t of m)if(t.id===`link_${e}`){e+=1,o=!0;break}}while(o);return`link_${e}`},A=function(e){(e=e||event).preventDefault(),e.stopPropagation()},v=function(e){let o;for(o=0;o<m.length&&m[o].id!==e;o++);if(o<m.length){m.splice(o,1);const t=$(`#filedrop-${p}`);t.find(`#fileupload-${p}-${e}`).remove(),$(`#thumbnail-${e}`).remove(),0===m.length&&t.find(".chooseFilesLabel").removeClass("hidden")}"Comparison"!==u.AppName&&"ImportData"!==u.ActionName&&"ImportCsv"!==u.ActionName&&openDB().then(function(e){updateDataBase(e,m).then()})},k=function(e){let o;for(o=0;o<m.length&&m[o].id!==e;o++);var t,n;o<m.length&&0!==o&&(t=m[o-1].id,n=m[o-1],m[o-1]=m[o],m[o]=n,n=$(`#filedrop-${p} > #fileupload-${p}-${e}`).detach(),$(`#filedrop-${p} > #fileupload-${p}-${t}`).before(n))},T=function(e){let o;for(o=0;o<m.length&&m[o].id!==e;o++);var t,n;o<m.length&&o!==m.length-1&&(t=m[o+1].id,n=m[o+1],m[o+1]=m[o],m[o]=n,n=$(`#filedrop-${p} > #fileupload-${p}-${e}`).detach(),$(`#filedrop-${p} > #fileupload-${p}-${t}`).after(n))},b=function(){checkUsageLimit().then(function(e){if(e)switch(u.AppName){case"Editor":case"Viewer":case"Chart":case"Form":return void u.Method();default:showLoader();var o=t();null!==o?$.ajax({method:"POST",url:`${u.APIBasePath}Common/UploadFile`,xhrFields:{withCredentials:!0},crossDomain:!0,data:o,processData:!1,contentType:!1,cache:!1,success:function(e){e.IsSuccess?u.Method(e):u.showAlert(e.idError)},error:function(e){u.showAlert(e.Status)}}):hideLoader()}else showUsageLimitModal()})},t=function(e=1,o=u.MaximumUploadFiles){if("Conversion"===u.AppName){var t=$("#inputTxt").val();if(void 0!==t&&0<t.length){if("json"===u.Extension.toLocaleLowerCase("en-US")&&!U(t))return u.showAlert("Please enter valid json data."),null;if("table"===u.Extension.toLocaleLowerCase("en-US")){var n=$(t).find("table");if("SINGLE"===$("input[name=SheetSchema]:checked").val())$.each(n,function(e,o){e=`tables(${e+1}).html`,o=new File([o.innerHTML],e);m.push({id:w(),file:o,name:e})});else{let t="";$.each(n,function(e,o){t+=o.innerHTML});var a="tables.html",n=new File([t],a);m.push({id:w(),file:n,name:a})}}else{var r=IsNullOrEmpty(UploadFileName)?`convert.${u.Extension.toLocaleLowerCase("en-US")}`:UploadFileName,t=new File([t],r);m[0]={id:w(),file:t,name:r}}}}if("Base64Converter"===u.AppName){r=$("#inputTxt").val();if(void 0!==r&&0<r.length){var l=IsNullOrEmpty(UploadFileName)?"base64.txt":UploadFileName;if(!function(e){try{var o=atob(e),t=btoa(o);return e===t}catch(e){return!1}}(r))return u.showAlert("Invalid content"),null;r=new File([r],l);m[0]={id:w(),file:r,name:l}}}var i,s,d,c;if("CodeConverter"!==u.AppName||void 0!==(l=$("#inputTxt").val())&&0<l.length&&(i=IsNullOrEmpty(UploadFileName)?"code_converter.json":UploadFileName,s=new File([l],i),m[0]={id:w(),file:s,name:i}),"Json2Schema"!==u.ActionName||void 0!==(s=$("#inputTxt").val())&&0<s.length&&(i=IsNullOrEmpty(UploadFileName)?"json_schema.json":UploadFileName,s=new File([s],i),m[0]={id:w(),file:s,name:i}),m.length){if(m.length<e)return u.showAlert(u.FileAmountMessage),null;if(o=DEFAULT_MAXIMUM_UPLOAD_FILES,m.length>o)return u.showAlert(u.FileAmountMessage),null;const p=new FormData;for(let e=0;e<m.length;e++)if(c=m[e],d=g(c),c.url||null===d||-1===h.indexOf(d)){if(!c.url)return u.showAlert(u.FileWrongTypeMessage+d),null;p.set(c.id,c.url)}else p.set(c.id,c.file,c.name);return p}return u.showAlert(u.FileProcessingErrorCodes[10006]),null};function U(e){if("string"==typeof e)try{var o=JSON.parse(e);return"object"==typeof o&&o}catch(e){return}}let o=!1;async function e(){if(u.ShowAdSense||u.AdDisplay&&2!==u.UserType){const e=document.createElement("script");e.src=u.AdScriptUrl,document.body.appendChild(e),o=!0}else o=!0}c.on("click.second",function(){o||e().then(function(){})});function n(t){let n=!1;if(t.target.files&&t.target.files.length){if(C(t.target.files.length+m.length))return y(u.UserType),u.showAlert(u.FileAmountMessage),window.setTimeout(function(){u.hideAlert()},ALERT_DURATION),n=!0,n;let o;u.hideAlert();for(let e=0;e<t.target.files.length;e++)if(o=g(t.target.files[e]),null!==o&&-1!==h.indexOf(o)){if("JSON"===o){const a=new FileReader,r=t.target.files[e],l=t.target.id;a.readAsText(r),a.onloadend=function(){U(a.result)?i(r,l):(n=!0,u.showAlert(u.IncorrectJson))}}else i(t.target.files[e],t.target.id);I(t.target.files[e].size,u)&&(n=!0,D(u.UserType),u.showAlert(u.FileProcessingErrorCodes[10005]),openDB().then(function(e){deleteDataBase(e).then(function(){window.setTimeout(function(){u.hideAlert()},ALERT_DURATION)})}))}else n=!0,null!==o&&(o=o.toLocaleUpperCase("en-US")),u.showAlert(u.FileWrongTypeMessage+o)}return $(`input#UploadFileInput-${p}`).val(""),o||e().then(function(){}),!n}$(`#dropboxBtn-${p}`).on("click",function(){var e={success:function(e){C(e.length+m.length)?(y(u.UserType),u.showAlert(u.FileAmountMessage),window.setTimeout(function(){u.hideAlert()},ALERT_DURATION)):(u.hideAlert(),e.forEach(function(o){let e=g(o);null!==e&&-1!==h.indexOf(e)?fetch(o.link).then(e=>e.blob()).then(e=>{e=new File([e],o.name,{type:e.type});i(e,`UploadFileInput-${p}`,u.UploadAndRedirect)}):(null!==e&&(e=e.toLocaleUpperCase("en-US")),u.showAlert(u.FileWrongTypeMessage+e))}))},cancel:function(){},linkType:"direct",multiselect:!1,extensions:u.Accept.split(",")};Dropbox.choose(e)});u.UploadAndRedirect?$(`#UploadFileInput-${p}`).on("change",function(e){n(e)&&b()}):$(`#UploadFileInput-${p}`).on("change",n);function a(e=!0){const o=$(`#externalUrlInput-${p}`);var t;C(m.length+1)?(e&&o.val(""),o.css("border","1px solid red"),u.showAlert(u.FileAmountMessage),window.setTimeout(function(){u.hideAlert()},ALERT_DURATION)):(t=o.val(),REGULAR_URL.test(t)?(o.css("border","1px solid #ccc"),function(e){const o=s();var t=e;let n=null,a=null;u.UseSorting&&(n=$(`
                    <a>
                        <i>
                        <svg class="fa icon icon-arrow-up frame0" viewBox="0 0 30 32"><path d="M28.768 17.339q0 0.911-0.661 1.607l-1.339 1.339q-0.679 0.679-1.625 0.679-0.964 0-1.607-0.679l-5.25-5.232v12.571q0 0.929-0.67 1.509t-1.616 0.58h-2.286q-0.946 0-1.616-0.58t-0.67-1.509v-12.571l-5.25 5.232q-0.643 0.679-1.607 0.679t-1.607-0.679l-1.339-1.339q-0.679-0.679-0.679-1.607 0-0.946 0.679-1.625l11.625-11.625q0.625-0.661 1.607-0.661 0.964 0 1.625 0.661l11.625 11.625q0.661 0.696 0.661 1.625z"/></svg>
                        </i>
                    </a>
                `),a=$(`
                    <a>
                        <i>
                        <svg class="fa icon icon-arrow-down frame0" viewBox="0 0 30 32"><path d="M28.768 14.857q0 0.946-0.661 1.607l-11.625 11.643q-0.696 0.661-1.625 0.661-0.946 0-1.607-0.661l-11.625-11.643q-0.679-0.643-0.679-1.607 0-0.946 0.679-1.625l1.321-1.339q0.696-0.661 1.625-0.661 0.946 0 1.607 0.661l5.25 5.25v-12.571q0-0.929 0.679-1.607t1.607-0.679h2.286q0.929 0 1.607 0.679t0.679 1.607v12.571l5.25-5.25q0.661-0.661 1.607-0.661 0.929 0 1.625 0.661l1.339 1.339q0.661 0.696 0.661 1.625z"/></svg>
                        </i>
                    </a>
                `),n.find("i").on("click",function(){k(o)}),a.find("i").on("click",function(){T(o)}));const r=$(`
                <a>
                    <i>
                    <svg class="fa icon icon-close frame0" viewBox="0 0 25 32"><path d="M23.179 23.607q0 0.714-0.5 1.214l-2.429 2.429q-0.5 0.5-1.214 0.5t-1.214-0.5l-5.25-5.25-5.25 5.25q-0.5 0.5-1.214 0.5t-1.214-0.5l-2.429-2.429q-0.5-0.5-0.5-1.214t0.5-1.214l5.25-5.25-5.25-5.25q-0.5-0.5-0.5-1.214t0.5-1.214l2.429-2.429q0.5-0.5 1.214-0.5t1.214 0.5l5.25 5.25 5.25-5.25q0.5-0.5 1.214-0.5t1.214 0.5l2.429 2.429q0.5 0.5 0.5 1.214t-0.5 1.214l-5.25 5.25 5.25 5.25q0.5 0.5 0.5 1.214z"/></svg>
                    </i>
                </a>
            `);r.find("i").on("click",function(){v(o)});const l=$(`
                <span class="filename">
                    <label class="custom-file-upload">${t}</label>
                </span>
            `);null!==n&&null!==a&&(l.append(n),l.append(a)),l.append(r);const i=$(`<div id="fileupload-${p}-${o}" class="fileupload"></div>`);i.on("dragover",A),i.on("drop",A),i.append(l),i.insertBefore(`#UploadFileInput-${p}`),m.push({id:o,name:t,url:e}),u.UploadAndRedirect&&b()}(t),e&&o.val(""),$(`#urlInputBox-${p}`).hide()):(u.showAlert("Invalid URL"),o.css("border","1px solid red"),window.setTimeout(function(){u.hideAlert()},ALERT_DURATION)))}function r(){showLoader();const a=$(`#externalUrlInput-${p}`);var e=a.val();REGULAR_URL.test(e)?(a.css("border","1px solid #ccc"),fetch(`${u.APIBasePath}WebConverterApi/GetWebStream`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:e})}).then(e=>e.blob()).then(e=>{if(0<e.size){var o=(new Date).getTime(),t="web-converter.html",e=new File([e],t,{type:"text/html"});const n=new FormData;n.set(o,e,t),fetch(`${u.APIBasePath}WebConverterApi/WebConverter?outputType=${$("#saveAs").val()}`,{method:"POST",body:n}).then(e=>e.json()).then(e=>{hideLoader(),workSuccess(e)}).catch(e=>{u.showAlert("Invalid URL"),a.css("border","1px solid red"),window.setTimeout(function(){u.hideAlert()},ALERT_DURATION)})}else u.showAlert("Invalid URL"),a.css("border","1px solid red"),window.setTimeout(function(){u.hideAlert()},ALERT_DURATION)}).catch(e=>{u.showAlert("Invalid URL"),a.css("border","1px solid red"),window.setTimeout(function(){u.hideAlert()},ALERT_DURATION)})):(u.showAlert("Invalid URL"),a.css("border","1px solid red"),window.setTimeout(function(){u.hideAlert()},ALERT_DURATION))}function l(e){if(e.action===google.picker.Action.PICKED){const o=e[google.picker.Response.DOCUMENTS];C(o.length+m.length)?(y(u.UserType),u.showAlert(u.FileAmountMessage),window.setTimeout(function(){u.hideAlert()},ALERT_DURATION)):(u.hideAlert(),o.forEach(function(o){let e=g(o);null!==e&&-1!==h.indexOf(e)?fetch(`https://www.googleapis.com/drive/v3/files/${o.id}?alt=media`,{method:"Get",headers:new Headers({Authorization:`Bearer ${AccessToken}`})}).then(e=>e.blob()).then(e=>{e=new File([e],o.name,{type:e.type});i(e,`UploadFileInput-${p}`,u.UploadAndRedirect)}):(null!==e&&(e=e.toLocaleUpperCase("en-US")),u.showAlert(u.FileWrongTypeMessage+e))}))}}function d(){if(PickerInited&&GisInited){const o=new google.picker.View(google.picker.ViewId.DOCS);var e=function(){const o=[],e=u.Accept.split(",");return e.forEach(e=>{switch(e){case".docx":o.push("application/vnd.openxmlformats-officedocument.wordprocessingml.document");break;case".pdf":o.push("application/pdf");break;case".xlsx":case".xls":case".xlsm":case".xlsb":o.push("application/vnd.openxmlformats-officedocument.spreadsheetml.sheet");break;case".ods":o.push("application/x-vnd.oasis.opendocument.spreadsheet");break;case".csv":o.push("text/csv");break;case".jpeg":o.push("image/jpeg");break;case".png":o.push("image/png");break;case".svg":o.push("image/svg+xml");break;case".json":o.push("application/vnd.google-apps.script+json");break;case".html":case".htm":case".mhtml":case".mht":o.push("text/html")}}),o.join(",")}();o.setMimeTypes(e);const t=(new google.picker.PickerBuilder).setDeveloperKey(API_KEY).setAppId(APP_ID).setOAuthToken(AccessToken).addView(o).setCallback(l).build();t.setVisible(!0)}}return $(`#externalUrlBtn-${p}`).on("click",a),$(`#cancelAddUrlBtn-${p}`).on("click",function(){$(`#urlInputBox-${p}`).hide(),$(`#externalUrlInput-${p}`).val("").css("border","1px solid #ccc")}),$(`#enterUrlBox-${p}`).click(function(){$(`#urlInputBox-${p}`).toggle()}),$(`#googleDriveBtn-${p}`).on("click",function(){TokenClient.callback=async e=>{if(void 0!==e.error)throw e;AccessToken=e.access_token,await d()},null===AccessToken?TokenClient.requestAccessToken({prompt:"consent"}):TokenClient.requestAccessToken({prompt:""})}),"Comparison"!==u.AppName&&"ImportData"!==u.ActionName&&"ImportCsv"!==u.ActionName&&openDB().then(function(e){getDataBase(e).then(function(e){IsNullOrEmpty(e)||$.each(e.files,function(e,o){i(o.file,`UploadFileInput-${p}`,u.UploadAndRedirect)})})}),{get droppedFiles(){return m},get prepareFormData(){return t},addEventListener:function(e,o){f[e]||(f[e]=[]),f[e].push(o)},reset(){m=[];const e=$(`#filedrop-${p}`);e.find("div[id^=fileupload-]").remove(),e.find(".chooseFilesLabel").removeClass("hidden")},get uploadFileFromUrl(){return a},get uploadFileFromWeb(){return r}}},$.QueryString=function(o){const t={};for(let e=0;e<o.length;++e){const n=o[e].split("=",2);2===n.length&&(t[n[0]]=decodeURIComponent(n[1].replace(/\+/g," ")))}return t}(window.location.search.substring(1).split("&")),$.fn.inputFilter=function(e){return this.on("input keydown keyup mousedown mouseup select contextmenu drop",function(){e(this.value)?(this.oldValue=this.value,this.oldSelectionStart=this.selectionStart,this.oldSelectionEnd=this.selectionEnd):this.hasOwnProperty("oldValue")?(this.value=this.oldValue,this.setSelectionRange(this.oldSelectionStart,this.oldSelectionEnd)):this.value=""})},function(){o.AppDownloadURL=o.AppUrl;let e=o.AppDownloadURL.indexOf(":");0<e?o.AppDownloadURL=`${0<e?o.AppDownloadURL.substring(e+3):o.AppUrl}/download`:o.AppDownloadURL+="/download",e=o.AppDownloadURL.indexOf("/"),o.AppDownloadURL=o.AppDownloadURL.substring(e)}(),function(){const e=window.location.search;var t,n;0<e.length&&e.includes("id")&&e.includes("FileName")&&(o.ReturnFromViewer=!0,t={StatusCode:200,FolderName:$.QueryString.id,FileName:$.QueryString.FileName,FileProcessingErrorCode:0},n=window.location.href.split("?")[0],window.history.pushState({},document.title,n),o.UploadAndRedirect||workSuccess(t))}(),"Conversion"===o.AppName&&".excel"===o.Accept&&(o.Accept=".xls,.xlsx,.xlsm,.xlsb");const e=$("form#UploadFile");function t(){$(".otherapps-panel-expand").hide(),$(".otherapps-panel-restore").removeClass("hidden");const e=$("#otherapps-panel");e.removeClass("otherapps-panel-collapse")}fileDrop=e.fileDrop(Object.assign({showAlert:showAlert,hideAlert:hideAlert,showLoader:showLoader,progress:progress,dropFilesPrompt:"Comparison"===o.AppName?o.ComparisonLocalizationResources.DropTargetFilePrompt:o.ComparisonLocalizationResources.DropFilesPrompt,dropFileId:o.DropFileId},o)),"Comparison"===o.AppName&&(fileDrop2=e.fileDrop(Object.assign({showAlert:showAlert,hideAlert:hideAlert,showLoader:showLoader,progress:progress,dropFilesPrompt:o.ComparisonLocalizationResources.DropSourceFilePrompt,dropFileId:++o.DropFileId},o))),"ImportData"===o.ActionName&&(fileDrop2=e.fileDrop(Object.assign(o,{showAlert:showAlert,hideAlert:hideAlert,showLoader:showLoader,progress:progress,dropFilesPrompt:o.ComparisonLocalizationResources.DropSourceFilePrompt,dropFileId:++o.DropFileId,Accept:".csv,.xml"}))),"ImportCsv"===o.ActionName&&(fileDrop2=e.fileDrop(Object.assign(o,{showAlert:showAlert,hideAlert:hideAlert,showLoader:showLoader,progress:progress,dropFilesPrompt:o.ComparisonLocalizationResources.DropSourceFilePrompt,dropFileId:++o.DropFileId,Accept:".csv"}))),window.onpopstate=function(){0<$("div#iframe-wrap").length&&closeIframe()},o.ShowHelpButton||$("#showHelpButton").on("click",function(){alert("showHelpButton");$("#help-dialog-template > .modal-dialog > .modal-content").html("/content/assembly/cellsHelpTemplate.html").contents()}),function(){const o=$("#bookmarkModal");o.on("show.bs.modal",function(){o.css("display","flex"),o.on("keydown",function(e){(e.metaKey||e.ctrlKey)&&"d"===String.fromCharCode(e.which).toLocaleLowerCase("en-US")&&o.modal("hide")})}),o.on("hidden.bs.modal",function(){o.off("keydown")});const e=$("#sendEmailModal");$("#sendEmailButton").on("click",function(){e.modal({keyboard:!0})}),e.on("show.bs.modal",function(){e.css("display","flex")}),e.on("shown.bs.modal",function(){$("#EmailToInput").focus()});const t=$("#feedbackModal");t.on("show.bs.modal",function(){t.css("display","flex")}),t.on("shown.bs.modal",function(){$("#feedbackBody").focus()}),$("#locale").on("click",function(){$("#langModal").modal({keyboard:!0})}),$("#langModal").on("show.bs.modal",function(){$("#langModal").css("display","flex")})}(),function(){const e=$("#otherapps-panel");430<=e.height()?($(".otherapps-panel-expand > div > svg").on("click",t),$(".otherapps-panel-restore > svg").on("click",restoreOtherApps)):($(".otherapps-panel-expand").hide(),$(".otherapps-panel-restore").hide())}(),$(".show-hide-menu").click(function(){$(".header").toggleClass("activemenu")}),$(".lang-selector-round").mouseover(function(){$(".lang-selector-round").toggleClass("showmenu")}),function(){const e=jQuery("body");e.on("click","#mobile-button",function(){jQuery(".topheader").toggleClass("topbutton")}),e.on("hover",".langselectordiv",function(){jQuery(".languageselectbox").toggleClass("show")}),window.screen.width<=768&&(e.on("click","#mobile-button",function(){jQuery(".userloginbox.desklink").appendTo("#DynabicMenuUserControlsclone")}),e.on("click",".mobileanchor",function(){return jQuery(".mobileanchor.openmenu").not(this).removeClass("openmenu"),jQuery(this).toggleClass("openmenu"),!1}))}(),$("#UploadFileInput").on("change",function(t){if(t.target.files&&t.target.files.length){showLoader();for(let e=0;e<t.target.files.length;e++){const a=new FileReader;var n=t.target.files[e];UploadFileName=n.name,a.readAsText(n),a.onloadend=function(){$("#inputTxt").val(a.result)}}hideLoader()}else showAlert(o.FileAmountMessage),window.setTimeout(function(){hideAlert()},ALERT_DURATION);$(this).val("")}),$("#browseBtn").click(function(){$("#UploadFileInput").click()}),$("#dropboxBtn").click(function(){Dropbox.choose({success:function(e){showLoader(),e.forEach(function(e){fetch(e.link).then(e=>e.blob()).then(e=>{const o=new FileReader;o.readAsText(e),o.onloadend=function(){$("#inputTxt").val(o.result)}})}),hideLoader()},cancel:function(){},linkType:"direct",multiselect:!1,extensions:[".json"]})});const n=$("#loadUrlModal");n.on("show.bs.modal",function(){n.css("display","flex"),$("#loadUrlModalInput").focus()}),$("#loadUrlBtn").click(function(){n.modal({backdrop:"static",keyboard:!1,show:!0})}),function(){$(".saturation input").on("mousemove touchmove touchend click",function(){var e=parseInt($(this).val());$(this).siblings(".saturation-value").css("width",`${e}%`),$(this).parent().siblings().children(".saturation-percentage").text(e)}),$("#WatermarkTextRepeatEnable").change(function(){"true"===$(this).val()?($(".repeat-true").show(),$(".repeat-false").hide()):($(".repeat-true").hide(),$(".repeat-false").show())}),$("#WatermarkTextSpacing").on("input propertychange",function(){checkNumber($(this),0,100,"The input number must be between 0-100")}),$("#WatermarkRotatedDegree").on("input propertychange",function(){checkNumber($(this),0,360,"The input number must be between 0-360")});const e=$("#modalOptions");e.on("show.bs.modal",function(){e.css("padding-top","6rem")}),$("#WatermarkType").change(function(){switch(this.value){case"Image":$("#WatermarkSection").removeClass("hidden"),$("#WatermarkContainer").removeClass("hidden"),$("#WatermarkTextEnable").addClass("hidden"),$("#WatermarkImageEnable").removeClass("hidden"),WatermarkType="Image";break;case"Text":$("#WatermarkSection").removeClass("hidden"),$("#WatermarkContainer").removeClass("hidden"),$("#WatermarkImageEnable").addClass("hidden"),$("#WatermarkTextEnable").removeClass("hidden"),WatermarkType="Text";break;default:$("#WatermarkSection").addClass("hidden"),$("#WatermarkContainer").addClass("hidden"),$("#WatermarkImageEnable").addClass("hidden"),$("#WatermarkTextEnable").addClass("hidden"),WatermarkType="None"}}),$("#WatermarkImage").change(function(e){0<e.target.files.length&&($("#WatermarkImageName").text(e.target.files[0].name),WatermarkImageStream=e.target.files[0])})}(),function(){if(768<screen.width&&o.StatisticsApps.includes(o.AppName))try{$.getJSON(`https://metrics.svc.k8s.dynabic.com/application/cells/${o.AppName.toLocaleLowerCase("en-US")}`,function(e){$("#processedFiles").text(e.files),$("#processedBytes").text(parseInt(e.bytes/1048/1048)),$("#statProcessed").children().removeClass("hidden")})}catch(e){}}();let a=document.getElementById("loginUrl");a?a.href=Urls.Login:(a=document.getElementById("logoutUrl"),a.href=Urls.Logout),async function(){function e(){PickerInited=!0}$.getScript("https://apis.google.com/js/api.js",function(){gapi.load("picker",e)}),$.getScript("https://accounts.google.com/gsi/client",function(){TokenClient=google.accounts.oauth2.initTokenClient({client_id:CLIENT_ID,scope:SCOPES,callback:""}),GisInited=!0})}().then(function(){$(document).on("keydown",function(e){if("KeyD"===e.originalEvent.code&&e.originalEvent.ctrlKey&&!e.originalEvent.altKey&&!e.originalEvent.shiftKey&&!e.originalEvent.metaKey&&"ga"in window)try{const o=window.ga.getAll()[0];void 0!==o&&o.send("event",{eventCategory:"[Ctrl + D] keypress",eventAction:`Target: ${window.location.pathname}`})}catch(e){}}),$("#googleDriveBtn").click(function(){function t(e){if(e.action===google.picker.Action.PICKED){showLoader();const o=e[google.picker.Response.DOCUMENTS];o.forEach(function(e){fetch(`https://www.googleapis.com/drive/v3/files/${e.id}?alt=media`,{method:"Get",headers:new Headers({Authorization:`Bearer ${AccessToken}`})}).then(e=>e.blob()).then(e=>{const o=new FileReader;o.readAsText(e),o.onloadend=function(){$("#inputTxt").val(o.result)}})}),hideLoader()}}TokenClient.callback=async e=>{if(void 0!==e.error)throw e;AccessToken=e.access_token,await function(){const e=new google.picker.View(google.picker.ViewId.DOCS);e.setMimeTypes("application/json");const o=(new google.picker.PickerBuilder).enableFeature(google.picker.Feature.NAV_HIDDEN).setDeveloperKey(API_KEY).setAppId(APP_ID).setOAuthToken(AccessToken).addView(e).addView(new google.picker.DocsUploadView).setCallback(t).build();o.setVisible(!0)}()},null===AccessToken?TokenClient.requestAccessToken({prompt:"consent"}):TokenClient.requestAccessToken({prompt:""})})})});